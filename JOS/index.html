</script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/js/foundation.min.js'></script>
  <link href="https://unpkg.com/jspsych@7.2.3/css/jspsych.css" rel="stylesheet" type="text/css" />


  <!-- Load jsPsych plugins-->
  <script src="https://unpkg.com/@jspsych/plugin-instructions@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-external-html@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-call-function"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>

  <!-- Load the global environment-->
  <script src="global-env.js"></script>
  <script src="info_sheets.js"></script>

  <!-- Load the CSV helper-->



  <!-- Load custom plugins from directory-->




</head>
<body></body>
<script>



//////////////////////////////////
//         Gloabl Settings      //
//////////////////////////////////

// Initalise jsPsych
  const jsPsych = initJsPsych({
    on_finish: function(data) {
     // jsPsych.data.get().localSave('csv','mydata.csv');
      if(jsPsych.data.get().select('accuracy').mean() < 0.10){window.location = attention_redirect_link} else {window.location = redirect_link}

     
    }
  })


// Settings
  const redirect_link ="https://app.prolific.co/submissions/complete?cc=CHGWKNI0"
 const attention_redirect_link ="https://app.prolific.co/submissions/complete?cc=C13PIUOF" // A seperate link for those who fail the attention check
 const version = 1.0;

// Global variables
 var trialnum = 1;
var  practice_trial = 1;



// Capture any url paramaters
 const PROLIFIC_PID = jsPsych.data.getURLVariable('PROLIFIC_PID');
 const SONA_PID = jsPsych.data.getURLVariable('id');
  jsPsych.data.addProperties({participant_id: PROLIFIC_PID});

  // Save to OSF
 const subject_id = jsPsych.randomization.randomID(10);
 const filename = `${subject_id}.csv`;



 const save_OSF = {
  type: jsPsychPipe,
  action: "save",
  experiment_id: "HPxOsPqT0eOh",
  filename: filename,
  data_string: ()=>jsPsych.data.get().csv()
};


//////////////////////////////////



 // Instructions


var instructions = {
    type: jsPsychInstructions,
    pages: [
    '<h2>Instructions</h2>In this study you will be shown a 5-letter English word that has been scrambled (an anagram).<br>Your job is to try and rearrange it to make the original word.',
    'For example, if you are shown the string:<br><strong>AEROP</strong><br><nr> Rearrange it to make a word that make sense in English<br>In this case you would type in the unscrambled word:<br><strong>OPERA</strong>',
    'On some trials you will be asked to indicate how confident you are that you will be able to solve the anagram',
    ],
    show_clickable_nav: true
}



var factors = {
    condition: ['JOS', 'NoJOS'],
    preview_no: [0]
}

var full_design = jsPsych.randomization.factorial(factors, 15, true);


var practice_design = jsPsych.randomization.factorial(factors, 2, true);





// Trials

var anagram_trial = {
  data: {scramble_anagram: jsPsych.timelineVariable('scrambled'), uncrambled_anagram: jsPsych.timelineVariable('unscrambled'), condition: jsPsych.timelineVariable('condition'), preview_no: jsPsych.timelineVariable('preview_no')},
  timeline: [
  {
    type: jsPsychHtmlKeyboardResponse,
    data: {trial_name: "present_anagram"},
    stimulus: function(data){
      


      reveal_these_letters = jsPsych.randomization.sampleWithoutReplacement([0,1,2,3,4], jsPsych.timelineVariable('preview_no'))
        primed_array = [];
        if(reveal_these_letters.includes(0)){primed_array[0] = jsPsych.timelineVariable('scrambled')[0]} else{primed_array[0] = "#"}
        if(reveal_these_letters.includes(1)){primed_array[1] = jsPsych.timelineVariable('scrambled')[1]} else{primed_array[1] = "#"}
        if(reveal_these_letters.includes(2)){primed_array[2] = jsPsych.timelineVariable('scrambled')[2]} else{primed_array[2] = "#"}
        if(reveal_these_letters.includes(3)){primed_array[3] = jsPsych.timelineVariable('scrambled')[3]} else{primed_array[3] = "#"}
        if(reveal_these_letters.includes(4)){primed_array[4] = jsPsych.timelineVariable('scrambled')[4]} else{primed_array[4] = "#"}

            primed_array = primed_array.join("");
            return('<div style = "position: absolute; top: 25%; left: 48.5%"><strong>' + primed_array+ '</strong></div>')


    },
    choices: "NO_KEYS",
    trial_duration: 0,
    on_finish: function(data){
      data.trialnum = trialnum;
    }
  },
  {
    type: jsPsychHtmlSliderResponse,
    data: {trial_name: "JOS"},
    stimulus: `<div style = "position: absolute; top: 25%; left: 48.5%"><strong>#####</strong></div><div style="width:500px;">
    <p><br>How confident are you that you will solve this anagram?</p?</div>
    </div>`,
    require_movement: true,
    labels: ["0%", "20%", '40%', '60%', "80%",'100%'],
     trial_duration: function(data){
      if(jsPsych.timelineVariable('condition') == "JOS"){return 8000}
      if(jsPsych.timelineVariable('condition') == "NoJOS"){return 0}
    },
    on_finish: function(data){
      data.trialnum = trialnum;
      data.stim_array = primed_array;
      data.item_index = jsPsych.timelineVariable('item_index');
    }
  },
    {
    type: jsPsychHtmlKeyboardResponse,
    data: {trial_name: "wait"},
    stimulus: `<div style = "position: absolute; top: 25%; left: 48.5%"><strong>#####</strong></div>`,
    choices: "NO_KEYS",
    on_finish: function(data){
      data.trialnum = trialnum;
      data.stim_array = primed_array;

    },
    trial_duration: function(data){
      if(jsPsych.timelineVariable('condition') == "NoJOS"){return 3000}
      if(jsPsych.timelineVariable('condition') == "JOS"){return 0}
    }
 },
  {
    type: jsPsychSurveyText,
      data: {trial_name: "anagram_response"},
    questions: [
      {prompt: function(){
        return('<div style = "position: absolute; top: 25%; left: 48.5%"><strong>' +jsPsych.timelineVariable('scrambled') + '</strong></div>Unscrambled the letters to make an English word and type it below:<br>If you do not know, simply leave the splace blank and hit "Continue"')
      }}
      ],
    on_finish(data){
     data.free_response = data.response.Q0;
     data.JOS = jsPsych.data.get().last(3).values()[0].response;
     data.trialnum = trialnum;
     trialnum = trialnum +1;

     if(data.response.Q0.toUpperCase() == jsPsych.timelineVariable('unscrambled').toUpperCase()){data.accuracy = 1} else (data.accuracy = 0)

   }
 }
 ],
  timeline_variables: [
    { unscrambled: 'CHAIR', scrambled: 'CARIH', item_index: 0, condition: full_design.condition[0], preview_no: full_design.preview_no[0]},
    { unscrambled: 'GRIEF', scrambled: 'EFRGI', item_index: 1, condition: full_design.condition[1], preview_no: full_design.preview_no[1]},
    { unscrambled: 'TRICK', scrambled: 'TKICR', item_index: 2, condition: full_design.condition[2], preview_no: full_design.preview_no[2]},
    { unscrambled: 'FAITH', scrambled: 'HFATI', item_index: 3, condition: full_design.condition[3], preview_no: full_design.preview_no[3]},
    { unscrambled: 'MERCY', scrambled: 'YMERC', item_index: 4, condition: full_design.condition[4], preview_no: full_design.preview_no[4]},
    { unscrambled: 'GLORY', scrambled: 'ROLYG', item_index: 5, condition: full_design.condition[5], preview_no: full_design.preview_no[5]},
    { unscrambled: 'LOGIC', scrambled: 'LICGO', item_index: 6, condition: full_design.condition[6], preview_no: full_design.preview_no[6]},
    { unscrambled: 'BRICK', scrambled: 'RIKCB', item_index: 7, condition: full_design.condition[7], preview_no: full_design.preview_no[7]},
    { unscrambled: 'BLADE', scrambled: 'ELBDA', item_index: 8, condition: full_design.condition[8], preview_no: full_design.preview_no[8]},
    { unscrambled: 'BUNCH', scrambled: 'CUBNH', item_index: 9, condition: full_design.condition[9], preview_no: full_design.preview_no[9]},
    { unscrambled: 'THUMB', scrambled: 'BTUHM', item_index: 10, condition: full_design.condition[10], preview_no: full_design.preview_no[10]},
    { unscrambled: 'YOUTH', scrambled: 'TOHUY', item_index: 11, condition: full_design.condition[11], preview_no: full_design.preview_no[11]},
    { unscrambled: 'DEMON', scrambled: 'NDOEM', item_index: 12, condition: full_design.condition[12], preview_no: full_design.preview_no[12]},
    { unscrambled: 'BENCH', scrambled: 'HCBNE', item_index: 13, condition: full_design.condition[13], preview_no: full_design.preview_no[13]},
    { unscrambled: 'ALBUM', scrambled: 'LBAUM', item_index: 14, condition: full_design.condition[14], preview_no: full_design.preview_no[14]},
    { unscrambled: 'CROWD', scrambled: 'CWORD', item_index: 15, condition: full_design.condition[15], preview_no: full_design.preview_no[15]},
    { unscrambled: 'MAKER', scrambled: 'ERAMK', item_index: 16, condition: full_design.condition[16], preview_no: full_design.preview_no[16]},
    { unscrambled: 'PILOT', scrambled: 'TLIOP', item_index: 17, condition: full_design.condition[17], preview_no: full_design.preview_no[17]},
    { unscrambled: 'GLOVE', scrambled: 'VEGLO', item_index: 18, condition: full_design.condition[18], preview_no: full_design.preview_no[18]},
    { unscrambled: 'CRUSH', scrambled: 'RSCUH', item_index: 19, condition: full_design.condition[19], preview_no: full_design.preview_no[19]},
    { unscrambled: 'OUNCE', scrambled: 'CEONU', item_index: 20, condition: full_design.condition[20], preview_no: full_design.preview_no[20]},
    { unscrambled: 'CABLE', scrambled: 'LEACB', item_index: 21, condition: full_design.condition[21], preview_no: full_design.preview_no[21]},
    { unscrambled: 'MONTH', scrambled: 'HTOMN', item_index: 22, condition: full_design.condition[22], preview_no: full_design.preview_no[22]},
    { unscrambled: 'PORCH', scrambled: 'ROPCH', item_index: 23, condition: full_design.condition[23], preview_no: full_design.preview_no[23]},
    { unscrambled: 'MAJOR', scrambled: 'OMJRA', item_index: 24, condition: full_design.condition[24], preview_no: full_design.preview_no[24]},
    { unscrambled: 'DRINK', scrambled: 'KNRDI', item_index: 25, condition: full_design.condition[25], preview_no: full_design.preview_no[25]},
    { unscrambled: 'PITCH', scrambled: 'CIPHT', item_index: 26, condition: full_design.condition[26], preview_no: full_design.preview_no[26]},
    { unscrambled: 'WHEAT', scrambled: 'EAWTH', item_index: 27, condition: full_design.condition[27], preview_no: full_design.preview_no[27]},
    { unscrambled: 'STYLE', scrambled: 'TLSYE', item_index: 28, condition: full_design.condition[28], preview_no: full_design.preview_no[28]},
    { unscrambled: 'WOUND', scrambled: 'WOUDN', item_index: 29, condition: full_design.condition[29], preview_no: full_design.preview_no[29]}

    ],
  randomize_order: true
}











var practice_anagram = {
  data: {phase: "practice", scramble_anagram: jsPsych.timelineVariable('scrambled'), uncrambled_anagram: jsPsych.timelineVariable('unscrambled'), condition: jsPsych.timelineVariable('condition'), preview_no: jsPsych.timelineVariable('preview_no')},
  timeline: [
  {
    type: jsPsychHtmlKeyboardResponse,
    data: {trial_name: "present_anagram"},
    stimulus: function(data){
      


      reveal_these_letters = jsPsych.randomization.sampleWithoutReplacement([0,1,2,3,4], jsPsych.timelineVariable('preview_no'))
        primed_array = [];
        if(reveal_these_letters.includes(0)){primed_array[0] = jsPsych.timelineVariable('scrambled')[0]} else{primed_array[0] = "#"}
        if(reveal_these_letters.includes(1)){primed_array[1] = jsPsych.timelineVariable('scrambled')[1]} else{primed_array[1] = "#"}
        if(reveal_these_letters.includes(2)){primed_array[2] = jsPsych.timelineVariable('scrambled')[2]} else{primed_array[2] = "#"}
        if(reveal_these_letters.includes(3)){primed_array[3] = jsPsych.timelineVariable('scrambled')[3]} else{primed_array[3] = "#"}
        if(reveal_these_letters.includes(4)){primed_array[4] = jsPsych.timelineVariable('scrambled')[4]} else{primed_array[4] = "#"}

            primed_array = primed_array.join("");
            return('<div style = "position: absolute; top: 25%; left: 48.5%"><strong>' + primed_array+ '</strong></div>')


    },
    choices: "NO_KEYS",
    trial_duration: 0,
    on_finish: function(data){
      data.trialnum = trialnum;
    }
  },
  {
    type: jsPsychHtmlSliderResponse,
    data: {trial_name: "JOS"},
    stimulus: `<div style = "position: absolute; top: 25%; left: 48.5%"><strong>#####</strong></div><div style="width:500px;">
    <p><br>How confident are you that you will solve this anagram?</p?</div>
    </div>`,
    require_movement: true,
    labels: ["0%", "20%", '40%', '60%', "80%",'100%'],
     trial_duration: function(data){
      if(jsPsych.timelineVariable('condition') == "JOS"){return 8000}
      if(jsPsych.timelineVariable('condition') == "NoJOS"){return 0}
    },
    on_finish: function(data){
      data.trialnum = trialnum;
      data.stim_array = primed_array;
      data.item_index = jsPsych.timelineVariable('item_index');
    }
  },
    {
    type: jsPsychHtmlKeyboardResponse,
    data: {trial_name: "wait"},
    stimulus: `<div style = "position: absolute; top: 25%; left: 48.5%"><strong>#####</strong></div>`,
    choices: "NO_KEYS",
    on_finish: function(data){
      data.trialnum = trialnum;
      data.stim_array = primed_array;

    },
    trial_duration: function(data){
      if(jsPsych.timelineVariable('condition') == "NoJOS"){return 3000}
      if(jsPsych.timelineVariable('condition') == "JOS"){return 0}
    }
 },
  {
    type: jsPsychSurveyText,
      data: {trial_name: "anagram_response"},
    questions: [
      {prompt: function(){
        return('<div style = "position: absolute; top: 25%; left: 48.5%"><strong>' +jsPsych.timelineVariable('scrambled') + '</strong></div>Unscrambled the letters to make an English word and type it below:<br>If you do not know, simply leave the splace blank and hit "Continue"')
      }}
      ],
    on_finish(data){
     data.free_response = data.response.Q0;
     data.JOS = jsPsych.data.get().last(3).values()[0].response;
     data.trialnum = trialnum;
     trialnum = trialnum +1;

     if(data.response.Q0.toUpperCase() == jsPsych.timelineVariable('unscrambled').toUpperCase()){data.accuracy = 1} else (data.accuracy = 0)

   }
 }
 ],
  timeline_variables: [
    { unscrambled: 'PRIZE', scrambled: 'ZEPIR', item_index: 0, condition: practice_design.condition[0], preview_no: practice_design.preview_no[0]},
    { unscrambled: 'INPUT', scrambled: 'TUNPI', item_index: 1, condition: practice_design.condition[1], preview_no: practice_design.preview_no[1]},
    { unscrambled: 'WORLD', scrambled: 'LOWDR', item_index: 2, condition: practice_design.condition[2], preview_no: practice_design.preview_no[2]},
    { unscrambled: 'HONEY', scrambled: 'YONEH', item_index: 3, condition: practice_design.condition[3], preview_no: practice_design.preview_no[3]}

    ],
  randomize_order: true
}







var begin_practice = {
  type:   jsPsychInstructions,
  pages: [
    "You will now complete 4 practice items."
    ],
  show_clickable_nav: true,
  allow_backward: false,
}

var begin = {
  type:   jsPsychInstructions,
  pages: [
    "Press Next when you are ready to begin the test. You will no longer receive feedback"
    ],
  show_clickable_nav: true,
  allow_backward: false,
}




      var estimation = {
        type: jsPsychHtmlSliderResponse,
          stimulus: `<div style="width:500px;">
                <p>Before you begin the anagram task, please predict your total score as a percentage score using the scale below</p?</div>
                </div>`,
            require_movement: true,
            labels: ["0%", "20%", "40%", "60%", "80%", "100%"],
            data: {trial_name: "prediction"}
          }


var debug = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Did you experience any issues while completing this study?', rows: 5}
    ]
}








  jsPsych.run([ participant_info_paid, participant_info_SONA, instructions, begin_practice, practice_anagram, estimation, begin, anagram_trial, debug, save_OSF, DEBRIEF_SONA]);





//

//


//welcome, demographics

  // Run the timeline
 // jsPsych.run([demographics, hello_trial, save_data]);





</script>
</html>
